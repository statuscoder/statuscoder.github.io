<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">
    <title>Controls</title>
    <!-- Bootstrap core CSS -->
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <style>

      @import url(https://fonts.googleapis.com/css?family=Montserrat:400);

      .data-container {
          margin-top: 0px;
      }

      .data-container .row .col {
        margin-top: 5px;
        margin-bottom: 0px;
      }

      .row-blue {
        background-color: dodgerblue;
        margin-left: auto;
        margin-right: auto;
        width: 100%;
      }

      .row-purple {
        background-color:mediumpurple;
        margin-left: auto;
        margin-right: auto;
        width: 100%;
      }

      .row-white {
        margin-left: auto;
        margin-right: auto;
        width: 100%;
      }
      .row-green {
        background-color:greenyellow;
        margin-left: auto;
        margin-right: auto;
        width: 100%;
      }

      .row-grey {
        background-color: #cccccc;
        margin-left: auto;
        margin-right: auto;
        width: 100%;
      }

      .api-path {
        width: 400px!important;
      }

      .motion-params {
        width: 265px!important;
      }

      .color-text {
        width: 55px!important;
      }

      .ufo-container {
        margin-top: 0px;
        background-color: #ffffff;
        margin-right: auto;
        margin-left: auto;
        width: 100%;
      }
      #col-bottom, #col-top, #col-wheel {
        height: 100%;
        width: 100%;
      }

      .col-result span {
        text-align: left;
      }

      .chart-text {
        font: 16px/1.4em "Montserrat", Arial, sans-serif;
        fill: #000;
        -moz-transform: translateY(0.25em);
        -ms-transform: translateY(0.25em);
        -webkit-transform: translateY(0.25em);
        transform: translateY(0.25em);
      }

      .chart-number {
        font-size: 0.6em;
        line-height: 1;
        text-anchor: middle;
        -moz-transform: translateY(-0.25em);
        -ms-transform: translateY(-0.25em);
        -webkit-transform: translateY(-0.25em);
        transform: translateY(-0.25em);
      }

      .chart-label {
        font-size: 0.2em;
        text-transform: uppercase;
        text-anchor: middle;
        -moz-transform: translateY(0.7em);
        -ms-transform: translateY(0.7em);
        -webkit-transform: translateY(0.7em);
        transform: translateY(0.7em);
      }
      .full-page {
          max-width: 100%;
          min-height: 100%;
      }

      .pull-left{
          float: left;
          width:20%;
          height: 100%;
      }

      .left-side{
          float: left;
      }

      body {
        background-color: #eeeeee;
      }
      .pull-right {
          float: right;
          width:80%;
          height: 100%;
          min-height: 100%;
      }

      .api-calls {
        width: 1000px;
        height: 300px;
        padding: 5px;
        font-family: Tahoma, sans-serif;
    }      
    </style>
  </head>
  <body>
    <div class="container full-page">
        <div class="pull-left">
            <div class="row">
                <div class="left-side" id="col-top">
                </div>
            </div>
            <div class="row">
                <div class="left-side" id="col-bottom">
                </div>
            </div>
        </div>
        <div class="pull-right">
            <div class="container data-container">
                <div
                    ><br/>
                    <span><strong>Instructions: </span>&nbsp;&nbsp;&nbsp;&nbsp;</strong>Pick a single item from option 'a' or multiple items from option 'b', then add your api url and click 'Send to UFO'</span>
                    <br/>
                    <span><strong>Addition help links:</strong></span>&nbsp;&nbsp;&nbsp;&nbsp;
                    <a href="https://www.dynatrace.com/solutions/devops/ufo/get/">UFO DevOps</a>
                    &nbsp;&nbsp;&nbsp;&nbsp;
                    <a href="https://github.com/Dynatrace/ufo">UFO Github Source</a>
                    &nbsp;&nbsp;&nbsp;&nbsp;
                    <a href="https://dynatrace.github.io/ufo/">UFO Github Page</a>
                    &nbsp;&nbsp;&nbsp;&nbsp;
                    <a href="https://github.com/Dynatrace/ufo-esp32">UFO gen2 Source + Help</a>
                    &nbsp;&nbsp;&nbsp;&nbsp;
                    <br/>
                    <br/>
                </div>
                <div class="row row-white">
                    <div class="col">    
                        <div class="d-flex flex-column flex-md-row align-items-center p-2 px-md-4 mb-3 bg-white border-bottom shadow-sm">
                            <h5 class="my-0 mr-md-auto font-weight-normal">a) Pre-set Params</h5>
                            <form class="form-inline mt-2 mt-md-0">
                                <label for="api-url">Params: </label>
                                &nbsp;&nbsp;
                                <select id="preSetParams"><option value="">NONE</option></select>
                            </form>
                        </div>
                    </div>
                </div>
                <div class="row row-white">
                    <div class="col">          
                        <div class="d-flex flex-column flex-md-row align-items-center p-2 px-md-4 mb-3 bg-white border-bottom shadow-sm">
                            <h5 class="my-0 mr-md-auto font-weight-normal">b) Reset Options</h5>
                            <form class="form-inline mt-2 mt-md-0">
                            <label for="reset-top">Top Row <img src="arrow-up.png" width="25px" height="25px"/> FG &amp; BG : </label>
                            &nbsp;&nbsp;
                            <input type="checkbox" class="form-control input-checkbox" id="reset-top">
                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                            <label for="reset-bottom">Bottom Row <img src="arrow-down.png" width="25px" height="25px"/> FG &amp; BG : </label>
                            &nbsp;&nbsp;
                            <input type="checkbox" class="form-control input-checkbox" id="reset-bottom">
                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                            <label for="reset-bottom">Logo Colors <img src="arrow-down.png" width="25px" height="25px"/> : </label>
                            &nbsp;&nbsp;
                            <input type="checkbox" class="form-control input-checkbox" id="reset-logo">
                            &nbsp;&nbsp;
                        </form>
                        </div>   
                        <div class="d-flex flex-column flex-md-row align-items-center p-2 px-md-4 mb-3 bg-white border-bottom shadow-sm">
                            <h5 class="my-0 mr-md-auto font-weight-normal">b)</h5> 
                            <strong class="my-0 mr-md-auto font-weight-normal"><img src="arrow-up.png" width="25%" height="25%"/> FG: </strong>
                            <form class="form-inline mt-2 mt-md-0">
                            <input class="ledcolor" type="color" name="top-fg" id="top-fg-1" value="#00ff00">&nbsp;&nbsp;
                            <input class="ledcolor" type="color" name="top-fg" id="top-fg-2" value="#00ff00">&nbsp;&nbsp;
                            <input class="ledcolor" type="color" name="top-fg" id="top-fg-3" value="#00ff00">&nbsp;&nbsp;
                            <input class="ledcolor" type="color" name="top-fg" id="top-fg-4" value="#00ff00">&nbsp;&nbsp;
                            <input class="ledcolor" type="color" name="top-fg" id="top-fg-5" value="#00ff00">&nbsp;&nbsp;
                            <input class="ledcolor" type="color" name="top-fg" id="top-fg-6" value="#00ff00">&nbsp;&nbsp;
                            <input class="ledcolor" type="color" name="top-fg" id="top-fg-7" value="#00ff00">&nbsp;&nbsp;
                            <input class="ledcolor" type="color" name="top-fg" id="top-fg-8" value="#00ff00">&nbsp;&nbsp;
                            <input class="ledcolor" type="color" name="top-fg" id="top-fg-9" value="#00ff00">&nbsp;&nbsp;
                            <input class="ledcolor" type="color" name="top-fg" id="top-fg-10" value="#00ff00">&nbsp;&nbsp;
                            <input class="ledcolor" type="color" name="top-fg" id="top-fg-11" value="#00ff00">&nbsp;&nbsp;
                            <input class="ledcolor" type="color" name="top-fg" id="top-fg-12" value="#00ff00">&nbsp;&nbsp;
                            <input class="ledcolor" type="color" name="top-fg" id="top-fg-13" value="#00ff00">&nbsp;&nbsp;
                            <input class="ledcolor" type="color" name="top-fg" id="top-fg-14" value="#00ff00">&nbsp;&nbsp;
                            <input class="ledcolor" type="color" name="top-fg" id="top-fg-15" value="#00ff00">
                            </form>                            
                        </div>   
                        <div class="d-flex flex-column flex-md-row align-items-center p-2 px-md-4 mb-3 bg-white border-bottom shadow-sm">
                            <h5 class="my-0 mr-md-auto font-weight-normal">b)</h5> 
                            <strong class="my-0 mr-md-auto font-weight-normal"><img src="arrow-up.png" width="25%" height="25%"/> BG: </strong>
                            <form class="form-inline mt-2 mt-md-0">
                            <input class="ledcolor" type="color" name="top-bg" id="top-bg-1" value="#00ff00">&nbsp;&nbsp;
                            <input class="ledcolor" type="color" name="top-bg" id="top-bg-2" value="#00ff00">&nbsp;&nbsp;
                            <input class="ledcolor" type="color" name="top-bg" id="top-bg-3" value="#00ff00">&nbsp;&nbsp;
                            <input class="ledcolor" type="color" name="top-bg" id="top-bg-4" value="#00ff00">&nbsp;&nbsp;
                            <input class="ledcolor" type="color" name="top-bg" id="top-bg-5" value="#00ff00">&nbsp;&nbsp;
                            <input class="ledcolor" type="color" name="top-bg" id="top-bg-6" value="#00ff00">&nbsp;&nbsp;
                            <input class="ledcolor" type="color" name="top-bg" id="top-bg-7" value="#00ff00">&nbsp;&nbsp;
                            <input class="ledcolor" type="color" name="top-bg" id="top-bg-8" value="#00ff00">&nbsp;&nbsp;
                            <input class="ledcolor" type="color" name="top-bg" id="top-bg-9" value="#00ff00">&nbsp;&nbsp;
                            <input class="ledcolor" type="color" name="top-bg" id="top-bg-10" value="#00ff00">&nbsp;&nbsp;
                            <input class="ledcolor" type="color" name="top-bg" id="top-bg-11" value="#00ff00">&nbsp;&nbsp;
                            <input class="ledcolor" type="color" name="top-bg" id="top-bg-12" value="#00ff00">&nbsp;&nbsp;
                            <input class="ledcolor" type="color" name="top-bg" id="top-bg-13" value="#00ff00">&nbsp;&nbsp;
                            <input class="ledcolor" type="color" name="top-bg" id="top-bg-14" value="#00ff00">&nbsp;&nbsp;
                            <input class="ledcolor" type="color" name="top-bg" id="top-bg-15" value="#00ff00">
                            </form>                            
                        </div>   
                        <div class="d-flex flex-column flex-md-row align-items-center p-2 px-md-4 mb-3 bg-white border-bottom shadow-sm">
                            <h5 class="my-0 mr-md-auto font-weight-normal">b)</h5> 
                            <strong class="my-0 mr-md-auto font-weight-normal"><img src="arrow-down.png" width="25%" height="25%"/> FG: </strong>
                            <form class="form-inline mt-2 mt-md-0">
                            <input class="ledcolor" type="color" name="btm-fg" id="btm-fg-1" value="#00ff00">&nbsp;&nbsp;
                            <input class="ledcolor" type="color" name="btm-fg" id="btm-fg-2" value="#00ff00">&nbsp;&nbsp;
                            <input class="ledcolor" type="color" name="btm-fg" id="btm-fg-3" value="#00ff00">&nbsp;&nbsp;
                            <input class="ledcolor" type="color" name="btm-fg" id="btm-fg-4" value="#00ff00">&nbsp;&nbsp;
                            <input class="ledcolor" type="color" name="btm-fg" id="btm-fg-5" value="#00ff00">&nbsp;&nbsp;
                            <input class="ledcolor" type="color" name="btm-fg" id="btm-fg-6" value="#00ff00">&nbsp;&nbsp;
                            <input class="ledcolor" type="color" name="btm-fg" id="btm-fg-7" value="#00ff00">&nbsp;&nbsp;
                            <input class="ledcolor" type="color" name="btm-fg" id="btm-fg-8" value="#00ff00">&nbsp;&nbsp;
                            <input class="ledcolor" type="color" name="btm-fg" id="btm-fg-9" value="#00ff00">&nbsp;&nbsp;
                            <input class="ledcolor" type="color" name="btm-fg" id="btm-fg-10" value="#00ff00">&nbsp;&nbsp;
                            <input class="ledcolor" type="color" name="btm-fg" id="btm-fg-11" value="#00ff00">&nbsp;&nbsp;
                            <input class="ledcolor" type="color" name="btm-fg" id="btm-fg-12" value="#00ff00">&nbsp;&nbsp;
                            <input class="ledcolor" type="color" name="btm-fg" id="btm-fg-13" value="#00ff00">&nbsp;&nbsp;
                            <input class="ledcolor" type="color" name="btm-fg" id="btm-fg-14" value="#00ff00">&nbsp;&nbsp;
                            <input class="ledcolor" type="color" name="btm-fg" id="btm-fg-15" value="#00ff00">
                            </form>                            
                        </div>   
                        <div class="d-flex flex-column flex-md-row align-items-center p-2 px-md-4 mb-3 bg-white border-bottom shadow-sm">
                            <h5 class="my-0 mr-md-auto font-weight-normal">b)</h5> 
                            <strong class="my-0 mr-md-auto font-weight-normal"><img src="arrow-down.png" width="25%" height="25%"/> BG: </strong>
                            <form class="form-inline mt-2 mt-md-0">
                            <input class="ledcolor" type="color" name="btm-bg" id="btm-bg-1" value="#00ff00">&nbsp;&nbsp;
                            <input class="ledcolor" type="color" name="btm-bg" id="btm-bg-2" value="#00ff00">&nbsp;&nbsp;
                            <input class="ledcolor" type="color" name="btm-bg" id="btm-bg-3" value="#00ff00">&nbsp;&nbsp;
                            <input class="ledcolor" type="color" name="btm-bg" id="btm-bg-4" value="#00ff00">&nbsp;&nbsp;
                            <input class="ledcolor" type="color" name="btm-bg" id="btm-bg-5" value="#00ff00">&nbsp;&nbsp;
                            <input class="ledcolor" type="color" name="btm-bg" id="btm-bg-6" value="#00ff00">&nbsp;&nbsp;
                            <input class="ledcolor" type="color" name="btm-bg" id="btm-bg-7" value="#00ff00">&nbsp;&nbsp;
                            <input class="ledcolor" type="color" name="btm-bg" id="btm-bg-8" value="#00ff00">&nbsp;&nbsp;
                            <input class="ledcolor" type="color" name="btm-bg" id="btm-bg-9" value="#00ff00">&nbsp;&nbsp;
                            <input class="ledcolor" type="color" name="btm-bg" id="btm-bg-10" value="#00ff00">&nbsp;&nbsp;
                            <input class="ledcolor" type="color" name="btm-bg" id="btm-bg-11" value="#00ff00">&nbsp;&nbsp;
                            <input class="ledcolor" type="color" name="btm-bg" id="btm-bg-12" value="#00ff00">&nbsp;&nbsp;
                            <input class="ledcolor" type="color" name="btm-bg" id="btm-bg-13" value="#00ff00">&nbsp;&nbsp;
                            <input class="ledcolor" type="color" name="btm-bg" id="btm-bg-14" value="#00ff00">&nbsp;&nbsp;
                            <input class="ledcolor" type="color" name="btm-bg" id="btm-bg-15" value="#00ff00">
                            </form>                            
                        </div>
                        <div class="d-flex flex-column flex-md-row align-items-center p-2 px-md-4 mb-3 bg-white border-bottom shadow-sm">
                            <h5 class="my-0 mr-md-auto font-weight-normal">b) Motion Options</h5>
                            <form class="form-inline mt-2 mt-md-0">
                            <label for="morph-motion">Morph Params: </label>
                                &nbsp;&nbsp;
                            <input type="checkbox" class="form-control input-checkbox" id="morph-check">
                                &nbsp;&nbsp;
                            <input type="text" class="form-control input-text motion-params" id="morph-motion" placeholder="Example: top_morph=80|8">
                                &nbsp;&nbsp;
                            <label for="whirl-motion">Whirl Params: </label>
                                &nbsp;&nbsp;
                                <input type="checkbox" class="form-control input-checkbox" id="whirl-check">
                                &nbsp;&nbsp;
                            <input type="text" class="form-control input-text motion-params" id="whirl-motion" placeholder="Example: top_whirl=240|ccw">
                            </form>
                        </div>
                    </div>
                </div>
                <div class="row row-white">
                    <div class="col">
                        <div class="d-flex flex-column flex-md-row align-items-center p-2 px-md-4 mb-3 bg-white border-bottom shadow-sm">
                        <h5 class="my-0 mr-md-auto font-weight-normal">Connect to UFO</h5>
                            <form class="form-inline mt-2 mt-md-0">
                            <label for="api-url">API URL: </label>
                            &nbsp;&nbsp;
                            <input type="text" class="form-control input-text api-path" id="api-url" placeholder="https://<ufourl>/api" onBlur="setUrlCookie()">
                                &nbsp;&nbsp;
                            <label for="reset-top">Connection Status: </label>
                                &nbsp;&nbsp;
                            <input type="color" id="api-status" name="api-status" value="#cccccc" disabled>
                            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                            <button class="btn btn-success" id="sendToUFO" data-id="-1">Send to UFO</button>
                            </form>
                        </div>   
                    </div>
                </div>
                <div class="row row-white">
                    <div class="col">
                        <h5 class="my-0 mr-md-auto font-weight-normal">Calls sent to UFO:</h5>
                        <div class="d-flex flex-column flex-md-row align-items-center p-2 px-md-4 mb-3 bg-white border-bottom shadow-sm">
                            <form class="form-inline mt-2 mt-md-0">
                                <textarea class="api-calls" id="result"></textarea>
                            </form>
                        </div>   
                    </div>
                </div>
            </div>        
        </div>
    </div>

  <!-- Page Content -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.bundle.min.js"></script>
  <script>

    //global vars
    //page elements DO-NOT-CHANGE
    var obj_presets = $('#preSetParams');
    var top_fg_colors = [];
    var top_bg_colors = [];
    var btm_fg_colors = [];
    var btm_bg_colors = [];
    var logo_colors = ["#ffff00", "#0080ff", "#6600cc", "#80ff00"];
    var log_flow = false;

    /********
    **
    **  SET YOUR CUSTOM PRE SETS HERE - CHANGE-BELOW
    **
    ********/
    //preset values
    var presets = {
      "NONE" : 
        { url: ""},
      "Turn Off UFO": 
        { 
            url: "top_init&bottom_init&logo=000000|000000|000000|000000",
            reset_top: true,
            reset_btm: true,
            reset_logo: true,
            top_fg: "000000",
            top_bg: "000000",
            btm_fg: "000000",
            btm_bg: "000000",
            logo_top: "000000",
            logo_left: "000000",
            logo_btm: "000000",
            logo_right: "800000",
            top_morph: "",
            btm_morph: "",
            top_whirl: "",
            btm_whirl: ""
        },
      "Two color with ccw whirl": 
        { 
            url: "logo_reset&top_init&bottom_init&top_bg=ffffff&top=0|12|00ff00&top_whirl=240&bottom_bg=ffffff&bottom=0|12|00ff00&bottom_whirl=240|ccw",
            reset_top: true,
            reset_btm: true,
            reset_logo: true,
            top_fg: "0|12|00ff00",
            top_bg: "ffffff",
            btm_fg: "0|12|00ff00",
            btm_bg: "ffffff",
            logo_top: "ffff00",
            logo_left: "0080ff",
            logo_btm: "6600cc",
            logo_right: "80ff00",
            top_morph: "",
            btm_morph: "",
            top_whirl: "240",
            btm_whirl: "240|ccw"
        },
      "All red": 
        { 
            url: "logo_reset&top_init&bottom_init&top=ff0000&bottom=ff0000&top_bg=ff0000&bottom_bg=ff0000",
            reset_top: true,
            reset_btm: true,
            reset_logo: true,
            top_fg: "ff0000",
            top_bg: "ff0000",
            btm_fg: "ff0000",
            btm_bg: "ff0000",
            logo_top: "ffff00",
            logo_left: "0080ff",
            logo_btm: "6600cc",
            logo_right: "80ff00",
            top_morph: "",
            btm_morph: "",
            top_whirl: "",
            btm_whirl: ""
        },
      "All white": 
        { 
            url: "logo_reset&top_init&bottom_init&top=ffffff&bottom=ffffff&top_bg=ffffff&bottom_bg=ffffff",
            reset_top: true,
            reset_btm: true,
            reset_logo: true,
            top_fg: "ffffff",
            top_bg: "ffffff",
            btm_fg: "ffffff",
            btm_bg: "ffffff",
            logo_top: "ffff00",
            logo_left: "0080ff",
            logo_btm: "6600cc",
            logo_right: "80ff00",
            top_morph: "",
            btm_morph: "",
            top_whirl: "",
            btm_whirl: ""
        },
      "Top Red, Bottom Green":
        { 
            url: "top=ff0000&bottom=00ff00&top_bg=ff0000&bottom_bg=00ff00",
            reset_top: true,
            reset_btm: true,
            reset_logo: true,
            top_fg: "ff0000",
            top_bg: "ff0000",
            btm_fg: "00ff00",
            btm_bg: "00ff00",
            logo_top: "ffff00",
            logo_left: "0080ff",
            logo_btm: "6600cc",
            logo_right: "80ff00",
            top_morph: "",
            btm_morph: "",
            top_whirl: "",
            btm_whirl: ""
        },
    };

    $(document).ready(function() {
        $("#api-url").val(getCookie('api-url'));
        $("#sendToUFO").on('click', function(e){
          buildAPICall(e,$(this));
        });
        $("#preSetParams").on('change', function(e){
            if (log_flow) console.log('changed pre set value');
            updateSettings(e,$(this));
        });
        $(".ledcolor").on('change', function(e){
            if (log_flow) console.log('changed led color');
            setupUFO();
        });

        //always
        populateSelect();
        setupUFO();
    });


    //js functions listed below
    function assignGroupLeds(row_prefix,color){
        for (i = 1; i < 16; i++)
        {
            $(row_prefix+i).val("#" + color);
        }
    }

    function assignIndividualLeds(row_prefix, row_content)
    {
        if (log_flow) console.log(row_prefix);
        if (Array.isArray(row_content) && row_content.length > 1)
        {
            var counter = row_content.length/3;
            if (log_flow) console.log('row_content is array with length of '+ counter );
            row_content.reverse()
            for(i = 0; i < counter; i++)
            {
                t_start= row_content.pop();
                t_count = row_content.pop();
                t_color = row_content.pop();
                for (l = t_start; l < t_start+t_count; l++){
                    $(row_prefix+l).val("#"+t_color);
                }
            }
        } else {
            for (i = 1; i < 16; i++)
            {
                $(row_prefix+i).val("#"+row_content);
            }
        }
    }

    function updateColorLeds(init_top, init_btm,top, top_bg, btm, btm_bg)
    {
        if (log_flow) console.log('updateColorLeds');
        top = top.split('|');
        top_bg = top_bg.split('|');
        btm = btm.split('|');
        btm_bg = btm_bg.split('|');
        
        //set defaults
        if (init_top) { 
            assignGroupLeds('#top-fg-',"000000");
            assignGroupLeds('#top-bg-',"000000");
        }
        if (init_btm) { 
            assignGroupLeds('#btm-fg-',"000000");
            assignGroupLeds('#btm-bg-',"000000");
        }

        //set top color
        assignIndividualLeds('#top-fg-',top);
        assignIndividualLeds('#top-bg-',top_bg);
        assignIndividualLeds('#btm-fg-',btm);
        assignIndividualLeds('#btm-bg-',btm_bg);

    }

    function updateColorArrays() {
        if (log_flow) console.log('updateColorsArray')
        top_fg_colors = [];
        top_bg_colors = [];
        btm_fg_colors = [];
        btm_bg_colors = [];
        for (i = 1; i < 16; i++)
        {
            top_fg_colors.push($('#top-fg-'+i).val());
            top_bg_colors.push($('#top-bg-'+i).val());
            btm_fg_colors.push($('#btm-fg-'+i).val());
            btm_bg_colors.push($('#btm-bg-'+i).val());
        }
    }

    function setUrlCookie(){
      setCookie('api-url',$('#api-url').val(),90);
    }

    function populateSelect() {
      if (log_flow) console.log('setPreSets');

      pre_set = document.getElementById('preSetParams');
      for (key in presets){
        for (subkey in presets[key])
        {
            if (subkey == "url") {
                var opt = document.createElement("option");
                opt.value = subkey;
                opt.text = key;
                pre_set.add(opt,null);            
            }
        }
      }
    }

    function setCookie(cname, cvalue, exdays) {
      if (log_flow) console.log('setCookie');
      var d = new Date();
      d.setTime(d.getTime() + (exdays*24*60*60*1000));
      var expires = "expires="+ d.toUTCString();
      var cookie = cname + "=" + cvalue + ";" + expires + ";path=/";
      if (log_flow) console.log(cookie);
      document.cookie = cookie;
    }

    function getCookie(cname) {
      if (log_flow) console.log('getCookie');

      var name = cname + "=";
      var decodedCookie = decodeURIComponent(document.cookie);
      if (log_flow) console.log(decodedCookie);
      var ca = decodedCookie.split(';');
      for(var i = 0; i <ca.length; i++) {
        var c = ca[i];
        if (log_flow) console.log(c);
        while (c.charAt(0) == ' ') {
          c = c.substring(1);
          if (log_flow) console.log(c);
        }
        if (c.indexOf(name) == 0) {
          if (log_flow) console.log(c.substring(name.length, c.length));
          return c.substring(name.length, c.length);
        }
      }
      return "";
    }

    function setupUFO()
    {
      updateColorArrays();      
      if (log_flow) console.log('setupUFO');
      makeUFO('top', '#000000', '#cccccc', top_fg_colors, top_bg_colors, 6.4, 6.659, "top",50);
      makeUFO('bottom', '#000000', '#cccccc', btm_fg_colors, btm_bg_colors, 6.4, 6.659, "top",50);
      makeLogo('bottom',20,20,30,30, logo_colors);
    }

    function updateSettings(e, element){
      e.preventDefault();
      var obj = document.getElementById('preSetParams')
      var id = obj.options[obj.selectedIndex].text;
      if (log_flow) console.log('updateSettings for '+id);
      if (id != 'NONE') {
        //options
        $('#reset-top').prop("checked",presets[id].reset_top);
        $('#reset-bottom').prop("checked",presets[id].reset_btm);
        $('#reset-logo').prop("checked",presets[id].reset_logo);

        updateColorLeds(presets[id].reset_top, presets[id].reset_btm,presets[id].top_fg, presets[id].top_bg, presets[id].btm_fg, presets[id].btm_bg);

        var tfa = presets[id].top_fg.split('|');
        var tba = presets[id].top_bg.split('|');
        var bfa = presets[id].btm_fg.split('|');
        var bba = presets[id].btm_bg.split('|');
        var tfc = "";
        var tbc = "";
        var bfc = "";
        var bbc = "";

        if (Array.isArray(tfa) && tfa.length > 2) {
            $('#top-fg-text').val(tfa[0] + "|" + tfa[1]);
            tfc =  tfa[2];
        } else {
            $('#top-fg-text').val("");
            tfc = tfa;
        }

        if (Array.isArray(tba) && tba.length > 2) {
            $('#top-bg-text').val(tba[0] + "|" + tba[1]);
            tbc =  tba[2];
        } else {
            $('#top-bg-text').val("");
            tbc = tba;
        }

        if (Array.isArray(bfa) && bfa.length > 2) {
            $('#btm-fg-text').val(bfa[0] + "|" + bfa[1]);
            bfc =  bfa[2];
        } else {
            $('#btm-fg-text').val("");
            bfc = bfa;
        }

        if (Array.isArray(bba) && bba.length > 2) {
            $('#btm-bg-text').val(bba[0] + "|" + bba[1]);
            bbc =  bba[2];
        } else {
            $('#btm-bg-text').val("");
            bbc = bba;
        }
 
        //colors
        $('#top-fg').val("#"+tfc);
        $('#top-bg').val("#"+tbc);
        $('#btm-fg').val("#"+bfc);
        $('#btm-bg').val("#"+bbc);
        
        //whirl
        if (presets[id].top_whirl.length > 0 && presets[id].btm_whirl.length > 0 ) {
            $('#whirl-motion').val("top_whirl=" + presets[id].top_whirl + "&" + "bottom_whirl=" + presets[id].btm_whirl);
            $('#whirl-check').prop("checked",(presets[id].top_whirl.length > 0 || presets[id].btm_whirl.length > 0) ? true : false);
        } else if (presets[id].top_whirl.length > 0 ) {
            $('#whirl-motion').val("top_whirl=" + presets[id].top_whirl);
            $('#whirl-check').prop("checked",(presets[id].top_whirl.length > 0) ? true : false);
        } else if (presets[id].btm_whirl.length > 0 ) {
            $('#whirl-motion').val("bottom_whirl=" + presets[id].btm_whirl);
            $('#whirl-check').prop("checked",(presets[id].btm_whirl.length > 0) ? true : false);
        } else {
            $('#whirl-motion').val("")
            $('#whirl-check').prop("checked",false);
        }
        
        //morph
        if (presets[id].top_morph.length > 0 && presets[id].btm_morph.length > 0 ) {
            $('#morph-motion').val("top_morph=" + presets[id].top_morph + "&" + "bottom_morph=" + presets[id].btm_morph);
            $('#morph-check').prop("checked",(presets[id].top_morph.length > 0 || presets[id].btm_morph.length > 0) ? true : false);
        } else if (presets[id].top_morph.length > 0 ) {
            $('#morph-motion').val("top_morph=" + presets[id].top_morph);
            $('#morph-check').prop("checked",(presets[id].top_morph.length > 0) ? true : false);
        } else if (presets[id].btm_morph.length > 0 ) {
            $('#morph-motion').val("bottom_morph=" + presets[id].btm_morph);
            $('#morph-check').prop("checked",(presets[id].btm_morph.length > 0) ? true : false);
        } else {
            $('#morph-motion').val("")
            $('#morph-check').prop("checked",false);
        }

      }      
      setupUFO();
    }

    function postAPI(url, params){
      var r = document.getElementById("result");
      if (log_flow) console.log('postAPI');

      url = url + params;
      if (log_flow) console.log(url);
      r.innerHTML = url + "\r\n" + r.innerHTML;

      if (log_flow) console.log('Ajax');
      $.ajax({
          url:  url,
          type: "GET",
          error: function() {
            $('#api-status').val('#ff0000');
            if (log_flow) console.log('error!');
          },
          success: function() {
            $('#api-status').val('#00ff00');
            if (log_flow) console.log('Done');
          }
      }); 

      /*
      $.ajax({
          url:  url,
          type: "GET"
      })
      .done(function() {
          if (log_flow) console.log('Done');
          $('#api-status').val('#00ff00');
      })
      .fail(function (xhr, status, error) {
            $('#api-status').val('#ff0000');
              if (log_flow) console.log('xhr:' + xhr + "!");
              if (log_flow) console.log('status:' + status + "!");
              if (log_flow) console.log('error:' + error + "!");
      });   
      */
    }

    function createLedColorParams(label,colors){
        var result = label + "=";
        var eoa = colors.length;
        for (i = 0; i < eoa; i++)
        {
            result += i + "|1|" + colors[i].substr(1,6) + "|";
        }
        return result.substr(0,result.length-1);
    }

    function buildAPICall(e, element){
        e.preventDefault();
        var url = $('#api-url').val() + "?";
        if (url.length == 1) {
            alert('The UFO URL path must be set before you can connect to a UFO.');
            return;
        }
        if (log_flow) console.log('buildAPICall');
        //set internal vars
        var obj = document.getElementById('preSetParams');
        var id = obj.options[obj.selectedIndex].text;
        if (log_flow) console.log(url);
        var params = "";
        params += document.querySelector("#reset-top").checked == true ? 'top_init&' : '';
        params += document.querySelector("#reset-bottom").checked == true ? 'bottom_init&' : '';
        params += document.querySelector("#reset-logo").checked == true ? 'logo_reset&' : '';
        params += createLedColorParams('top_bg',top_bg_colors);
        params += createLedColorParams('top',top_fg_colors);
        params += createLedColorParams('bottom_bg',btm_bg_colors);
        params += createLedColorParams('bottom',btm_fg_colors);
        params += (document.querySelector("#morph-check").checked == true && $("#morph-motion").val().length > 0) ? $('#morph-motion').val() + '&' : ''; 
        params += (document.querySelector("#whirl-check").checked == true && $("#whirl-motion").val().length > 0) ? $('#whirl-motion').val() + '&' : ''; 
        params = params.substr(0,params.length-1);

        if (log_flow) console.log("changing ufo");
        
        //changeColors(id);
        postAPI(url, params);
        setupUFO();

    }

    function removeAllChildNodes(parent) {
       while (parent.firstChild) {
            parent.removeChild(parent.firstChild);
        }
    }    

    function makeUFOv2(id, insidecolor, gapcolor, ledcolors, size, showLogo, logocolors){
        numSegments = 15;
        var cx = size/2;
        var cy = size/2;
        var div = document.getElementById("col-"+id);
        removeAllChildNodes(div);        

        var svgns = xmlns="http://www.w3.org/2000/svg";
        var svg = document.createElementNS(svgns, "svg");

        var circle = document.createElementNS("http://www.w3.org/2000/svg", "circle");
            circle.setAttribute('class','donut-ring');
            circle.setAttribute('cx',cx);
            circle.setAttribute('cy',cy);
            circle.setAttribute('r',17);
            circle.setAttribute('fill',gapcolor);
        svg.appendChild(circle);            

        circle = document.createElementNS("http://www.w3.org/2000/svg", "circle");
            circle.setAttribute('class','donut-hole');
            circle.setAttribute('cx',cx);
            circle.setAttribute('cy',cy);
            circle.setAttribute('r',15);
            circle.setAttribute('fill',insidecolor);
        svg.appendChild(circle);

        var defs = document.createElementNS("http://www.w3.org/2000/svg", "defs")
        defs.setAttribute('id',"defs");

        var g = document.createElementNS("http://www.w3.org/2000/svg", "g");
        g.setAttribute('id',"pathss");
        g.setAttribute('fill',"none");
        g.setAttribute('stroke-width',"1.5");
        g.setAttribute('transform',"translate("+cx+","+cy+")");

        svg.setAttribute('viewBox',"0 0 " + size + " " + size);
        svg.setAttribute('id',"svg-"+id);
        svg.setAttribute('width',"100%");
        svg.setAttribute('height',"100%");

        //svg.appendChild(defs);
        svg.appendChild(g);
        div.appendChild(svg);

        var radius = 16;
        var stepAngle = 2 * Math.PI / numSegments;

        var lastX = 0;
        var lastY = -radius;
        var lastAngle = 0;
        
        //for (var i=1; i<=numSegments; i++)
        for (var i=1; i<=numSegments; i++)
        {
            var angle = i * stepAngle;

            // Calculate this arc end point
            var x = radius * Math.sin(angle);
            var y = -radius * Math.cos(angle);
            // Create a path element
            var arc = document.createElementNS(svgns, "path");
            arc.setAttribute("d", "M " + lastX.toFixed(3) + "," + lastY.toFixed(3)
                                + " A 100,100 0 0,1 " + x.toFixed(3) + "," + y.toFixed(3));
            arc.setAttribute("stroke", ledcolors[i-1]);
            // Append it to our SVG
            g.appendChild(arc);
            
            // Create a gradient for this segment
            var grad = document.createElementNS(svgns, "linearGradient");
            grad.setAttribute("id", "wheelseg"+i);
            grad.setAttribute("gradientUnits", "userSpaceOnUse");
            grad.setAttribute("x1", lastX.toFixed(3));
            grad.setAttribute("y1", lastY.toFixed(3));
            grad.setAttribute("x2", x.toFixed(3));
            grad.setAttribute("y2", y.toFixed(3));
            // Make the 0% stop for this gradient
            var stop = document.createElementNS(svgns, "stop");
            stop.setAttribute("offset", "0%");
            hue = Math.round(lastAngle * 360 / Math.PI / 2);
            stop.setAttribute("stop-color", "hsl(" + hue + ",100%,50%)");
            grad.appendChild(stop);
            // Make the 100% stop for this gradient
            stop = document.createElementNS(svgns, "stop");
            stop.setAttribute("offset", "100%");
            hue = Math.round(angle * 360 / Math.PI / 2);
            stop.setAttribute("stop-color", "hsl(" + hue + ",100%,50%)");
            grad.appendChild(stop);
            // Add the gradient to the SVG
            defs.appendChild(grad);


            // Update lastx/y
            lastX = x;
            lastY = y;
            lastAngle = angle;
        }
        if (showLogo) {
            makeLogo("svg-"+id,cx-5,cy-5,cx+5,cy+5, logocolors);        
        }
    }
    
    function makeUFO(id, insidecolor, gapcolor, fgcolors, bgcolors, dashlength, rotationoffset, label, size){
        if (log_flow) console.log('makeUFO '+id);
        var svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
        svg.setAttribute('class','donut');
        svg.setAttribute('id',"ufo-"+id);
        svg.setAttribute('viewBox',"0 0 " + size + " " + size);
        svg.setAttribute('width',"100%");
        svg.setAttribute('height',"100%");
        var div = document.getElementById("col-"+id);
        removeAllChildNodes(div);        
        var l = 15;
        var ro = 25;
        var cx = size/2;
        var cy = size/2;
        var r = 15.91549430918954;
        //var r = 16;
        var f = "transparent";
        var sw = 2.3;
        var d = dashlength + " " + (100-dashlength);

        var circle = document.createElementNS("http://www.w3.org/2000/svg", "circle");
            circle.setAttribute('class','donut-ring');
            circle.setAttribute('cx',cx);
            circle.setAttribute('cy',cy);
            circle.setAttribute('r',17);
            circle.setAttribute('fill',gapcolor);
        svg.appendChild(circle);            

        circle = document.createElementNS("http://www.w3.org/2000/svg", "circle");
            circle.setAttribute('class','donut-hole');
            circle.setAttribute('cx',cx);
            circle.setAttribute('cy',cy);
            circle.setAttribute('r',15);
            circle.setAttribute('fill',insidecolor);
        svg.appendChild(circle);


        circle = document.createElementNS("http://www.w3.org/2000/svg", "circle");
        for(var i = 0; i < l; i++)
        {
            circle = document.createElementNS("http://www.w3.org/2000/svg", "circle");
            circle.setAttribute('class','donut-segment');
            circle.setAttribute('cx',cx);
            circle.setAttribute('cy',cy);
            circle.setAttribute('r',r);
            circle.setAttribute('fill',f);
            circle.setAttribute('stroke', fgcolors[i] == "#000000" ? bgcolors[i] : fgcolors[i]);
            circle.setAttribute('stroke-width',sw);
            circle.setAttribute('stroke-dasharray',d);
            circle.setAttribute('stroke-dashoffset',ro);
            svg.appendChild(circle);                
            ro = ro - rotationoffset;
        }
        var g = document.createElementNS("http://www.w3.org/2000/svg", "g");
            g.setAttribute('class','chart-text');
        var t = document.createElementNS("http://www.w3.org/2000/svg", "text");
            t.setAttribute('class','chart-number');
            t.setAttribute('x','50%');
            t.setAttribute('y','50%');
            t.innerHTML = l;
            g.appendChild(t);
            t = document.createElementNS("http://www.w3.org/2000/svg", "text");
            t.setAttribute('class','chart-label');
            t.setAttribute('x','50%');
            t.setAttribute('y','50%');
            t.innerHTML = label;
            g.appendChild(t);
        //svg.appendChild(g);
        div.appendChild(svg);

    }
        
    function makeLogo(id, t,l,b,r,colors){
      if (log_flow) console.log('makeLogo');
        var svg = document.getElementById('ufo-'+id);
        var p = document.createElementNS("http://www.w3.org/2000/svg", "polygon");
        var pts = "{{xy1}} {{xy2}} {{xy3}} {{xy4}} ";
        var sl = ((b-t)/4);
        var ll = (b-t);
        var xy1, xy2, xy3, xy4, t_pts;

        //top
        xy1 = (l+sl) + "," + t; 
        xy2 = l + "," + (t+sl); 
        xy3 = (r-sl) + "," + (t+sl); 
        xy4 = r + "," + t; 
        t_pts = pts;
        t_pts = t_pts.replace(/{{xy1}}/g,xy1).replace(/{{xy2}}/g,xy2).replace(/{{xy3}}/g,xy3).replace(/{{xy4}}/g,xy4);
        p.setAttribute('points', t_pts);
        p.setAttribute('fill',colors[0]);
        svg.appendChild(p);


        //left
        p = document.createElementNS("http://www.w3.org/2000/svg", "polygon");   
        xy1 = l+","+(t+sl); 
        xy2 = (l+sl)+","+(t+sl); 
        xy3 = (l+sl)+","+(b-sl); 
        xy4 = l+","+b; 
        t_pts = pts;
        t_pts = t_pts.replace(/{{xy1}}/g,xy1).replace(/{{xy2}}/g,xy2).replace(/{{xy3}}/g,xy3).replace(/{{xy4}}/g,xy4);            
        p.setAttribute('points', t_pts);
        p.setAttribute('fill',colors[1]);
        svg.appendChild(p);


        //bottom
        p = document.createElementNS("http://www.w3.org/2000/svg", "polygon");   
        xy1 = l+","+b; 
        xy2 = (l+sl)+","+(b-sl); 
        xy3 = (r-sl)+","+(b-sl); 
        xy4 = (r-sl)+","+b; 
        t_pts = pts;
        t_pts = t_pts.replace(/{{xy1}}/g,xy1).replace(/{{xy2}}/g,xy2).replace(/{{xy3}}/g,xy3).replace(/{{xy4}}/g,xy4);            
        p.setAttribute('points', t_pts);
        p.setAttribute('fill',colors[2]);
        svg.appendChild(p);

        //right
        p = document.createElementNS("http://www.w3.org/2000/svg", "polygon");   
        xy1 = (r-sl)+","+b; 
        xy2 = (r-sl)+","+(t+sl); 
        xy3 = r+","+t; 
        xy4 = r+","+(b-sl); 
        t_pts = pts;
        t_pts = t_pts.replace(/{{xy1}}/g,xy1).replace(/{{xy2}}/g,xy2).replace(/{{xy3}}/g,xy3).replace(/{{xy4}}/g,xy4);            
        p.setAttribute('points', t_pts);
        p.setAttribute('fill',colors[3]);
        svg.appendChild(p);

    }    

</script>
</body>
</html>